<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hồ sơ khoa học — Website cá nhân</title>
  <meta name="description" content="Website cá nhân chuyên nghiệp dành cho nhà khoa học: hồ sơ, học tập, làm việc, kỹ năng, công trình nghiên cứu và liên hệ." />
  <meta name="theme-color" content="#0B1220" />

  <!-- Open Graph -->
  <meta property="og:title" content="Hồ sơ khoa học — Website cá nhân" />
  <meta property="og:description" content="Hồ sơ, học tập, làm việc, kỹ năng, công trình nghiên cứu và liên hệ." />
  <meta property="og:type" content="website" />

  <!-- Fonts (Modern + Luxury) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <style>
    :root {
      color-scheme: light;
      --bg: #f7fbff;               /* near-white */
      --ink: #071428;              /* deep navy */
      --muted: rgba(7, 20, 40, .62);
      --card: rgba(255,255,255,.84);
      --border: rgba(7, 20, 40, .12);
      --shadow: 0 10px 30px rgba(6, 18, 35, .10);
      --acc1: #16a34a;             /* cold green */
      --acc2: #2563eb;             /* cold blue */
      --acc3: #22d3ee;             /* cyan highlight */
    }
    html.dark {
      color-scheme: dark;
      --bg: #0b1220;
      --ink: #eaf2ff;
      --muted: rgba(234, 242, 255, .64);
      --card: rgba(10, 18, 34, .72);
      --border: rgba(234, 242, 255, .14);
      --shadow: 0 16px 40px rgba(0,0,0,.45);
    }

    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      text-rendering: geometricPrecision;
    }
    h1, h2, h3, .font-display {
      font-family: Sora, ui-sans-serif, system-ui;
      letter-spacing: -0.02em;
    }

    /* Subtle modern grid */
    .bg-grid {
      background-image:
        linear-gradient(to right, rgba(37, 99, 235, .10) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(22, 163, 74, .08) 1px, transparent 1px);
      background-size: 34px 34px;
    }

    /* Focus ring */
    .focus-ring:focus-visible {
      outline: none;
      box-shadow: 0 0 0 4px rgba(34, 211, 238, .28);
    }

    /* Reveal animations */
    .reveal {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .65s ease, transform .65s ease;
    }
    .reveal.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    @media (prefers-reduced-motion: reduce) {
      .reveal { transition: none; transform: none; }
      html { scroll-behavior: auto !important; }
    }

    @media print {
      header, #toTop, #toast, #ownerBadge, #ownerPanelBtn, #ownerHint { display: none !important; }
      body { background: white !important; color: black !important; }
      .reveal { opacity: 1 !important; transform: none !important; }
    }
  </style>

  <script>
    // Prevent FOUC for theme
    (function() {
      try {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const useDark = saved ? (saved === 'dark') : systemDark;
        document.documentElement.classList.toggle('dark', useDark);
      } catch(e) {}
    })();
  </script>
</head>

<body class="min-h-screen bg-[var(--bg)] text-[var(--ink)] antialiased">
  <!-- Ambient glow (cold green/blue) -->
  <div class="pointer-events-none fixed inset-0 -z-10">
    <div class="absolute -top-32 left-1/2 h-[520px] w-[920px] -translate-x-1/2 rounded-full bg-gradient-to-r from-emerald-300/30 via-cyan-200/25 to-blue-300/30 blur-3xl dark:from-emerald-500/10 dark:via-cyan-400/10 dark:to-blue-500/10"></div>
    <div class="absolute bottom-0 left-0 right-0 h-[320px] bg-gradient-to-t from-blue-200/25 to-transparent dark:from-blue-500/10"></div>
  </div>

  <!-- NAV -->
  <header class="sticky top-0 z-50 border-b border-[var(--border)] bg-[var(--card)] backdrop-blur">
    <div class="mx-auto max-w-6xl px-4">
      <div class="flex h-16 items-center justify-between gap-3">
        <a href="#home" class="group flex items-center gap-3 rounded-xl px-2 py-1 focus-ring">
          <span class="relative inline-flex h-9 w-9 items-center justify-center overflow-hidden rounded-xl border border-[var(--border)] bg-gradient-to-br from-emerald-500 to-blue-600 text-white shadow-sm">
            <span class="text-sm font-semibold" id="brandInitials">NK</span>
          </span>
          <div class="hidden sm:block">
            <div class="font-display text-sm font-semibold leading-tight" id="brandName">Nguyễn A</div>
            <div class="text-xs text-[var(--muted)]" id="brandRole">Nhà khoa học · Nghiên cứu</div>
          </div>
        </a>

        <nav class="hidden md:flex items-center gap-1" aria-label="Điều hướng">
          <a data-nav href="#home" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm text-[var(--muted)] hover:bg-black/5 dark:hover:bg-white/10">Trang chủ</a>
          <a data-nav href="#profile" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm text-[var(--muted)] hover:bg-black/5 dark:hover:bg-white/10">Thông tin</a>
          <a data-nav href="#education" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm text-[var(--muted)] hover:bg-black/5 dark:hover:bg-white/10">Học tập</a>
          <a data-nav href="#work" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm text-[var(--muted)] hover:bg-black/5 dark:hover:bg-white/10">Làm việc</a>
          <a data-nav href="#skills" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm text-[var(--muted)] hover:bg-black/5 dark:hover:bg-white/10">Kỹ năng</a>
          <a data-nav href="#research" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm text-[var(--muted)] hover:bg-black/5 dark:hover:bg-white/10">Công trình</a>
          <a data-nav href="#contact" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm text-[var(--muted)] hover:bg-black/5 dark:hover:bg-white/10">Liên hệ</a>
        </nav>

        <div class="flex items-center gap-2">
          <button id="themeToggle" class="focus-ring inline-flex items-center gap-2 rounded-xl border border-[var(--border)] bg-white/60 px-3 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" aria-label="Chuyển chế độ sáng/tối">
            <span id="themeIcon" class="inline-block h-4 w-4" aria-hidden="true"></span>
            <span class="hidden sm:inline">Giao diện</span>
          </button>

          <button id="ownerPanelBtn" class="hidden focus-ring inline-flex items-center gap-2 rounded-xl border border-[var(--border)] bg-gradient-to-r from-emerald-600 to-blue-600 px-3 py-2 text-sm font-medium text-white hover:opacity-95" aria-label="Owner panel">
            <span class="text-xs">Owner</span>
          </button>

          <button id="mobileMenuBtn" class="md:hidden focus-ring inline-flex items-center justify-center rounded-xl border border-[var(--border)] bg-white/60 p-2 hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" aria-label="Mở menu" aria-expanded="false">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile nav -->
      <div id="mobileNav" class="md:hidden hidden pb-4">
        <div class="grid gap-2 rounded-2xl border border-[var(--border)] bg-[var(--card)] p-2">
          <a data-nav href="#home" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm hover:bg-black/5 dark:hover:bg-white/10">Trang chủ</a>
          <a data-nav href="#profile" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm hover:bg-black/5 dark:hover:bg-white/10">Thông tin</a>
          <a data-nav href="#education" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm hover:bg-black/5 dark:hover:bg-white/10">Học tập</a>
          <a data-nav href="#work" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm hover:bg-black/5 dark:hover:bg-white/10">Làm việc</a>
          <a data-nav href="#skills" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm hover:bg-black/5 dark:hover:bg-white/10">Kỹ năng</a>
          <a data-nav href="#research" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm hover:bg-black/5 dark:hover:bg-white/10">Công trình</a>
          <a data-nav href="#contact" class="nav-link focus-ring rounded-xl px-3 py-2 text-sm hover:bg-black/5 dark:hover:bg-white/10">Liên hệ</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Owner badge hint (hidden unless owner unlocked) -->
  <div id="ownerBadge" class="fixed bottom-5 left-5 z-50 hidden">
    <div class="rounded-2xl border border-[var(--border)] bg-[var(--card)] px-4 py-3 text-xs text-[var(--muted)] shadow-sm">
      <div class="flex items-center gap-2">
        <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
        <span><b>Owner mode</b> đang bật (chỉ trên trình duyệt của bạn)</span>
      </div>
      <div id="ownerHint" class="mt-2 text-[11px] text-[var(--muted)]">
        Tip: Để ảnh hiển thị cho mọi người, hãy commit file ảnh vào repo và đặt <code>profile.avatarUrl</code> trong phần DATA.
      </div>
    </div>
  </div>

  <main>
    <!-- HERO -->
    <section id="home" class="relative">
      <div class="mx-auto max-w-6xl px-4 pt-14 pb-10 sm:pt-20 sm:pb-14">
        <div class="grid items-start gap-10 lg:grid-cols-12">
          <div class="lg:col-span-7">
            <div class="reveal inline-flex items-center gap-2 rounded-full border border-[var(--border)] bg-[var(--card)] px-3 py-1 text-xs text-[var(--muted)]">
              <span class="h-2 w-2 rounded-full bg-gradient-to-r from-emerald-500 to-blue-600"></span>
              <span id="heroStatus">Hồ sơ khoa học cá nhân — cập nhật thường xuyên</span>
            </div>

            <h1 class="reveal mt-5 text-3xl font-semibold tracking-tight sm:text-5xl">
              <span class="block text-[var(--muted)] text-base sm:text-lg font-normal">Xin chào, tôi là</span>
              <span id="heroName" class="font-display bg-gradient-to-r from-emerald-600 via-cyan-600 to-blue-700 bg-clip-text text-transparent">Nguyễn A</span>
              <span class="block mt-2 text-xl sm:text-2xl text-[var(--muted)]" id="heroRole">Nhà khoa học · Chuyên ngành</span>
            </h1>

            <p id="heroSlogan" class="reveal mt-4 max-w-2xl text-base leading-relaxed text-[var(--muted)] sm:text-lg">
              Tập trung vào nghiên cứu ứng dụng, công bố khoa học và chuyển giao tri thức.
            </p>

            <div class="reveal mt-6 flex flex-col gap-3 sm:flex-row sm:items-center">
              <a href="#research" class="focus-ring inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-emerald-600 to-blue-600 px-5 py-3 text-sm font-semibold text-white shadow-sm hover:opacity-95">
                Xem công trình
              </a>
              <a href="#contact" class="focus-ring inline-flex items-center justify-center rounded-2xl border border-[var(--border)] bg-white/60 px-5 py-3 text-sm font-medium text-[var(--ink)] hover:bg-white dark:bg-black/30 dark:hover:bg-black/45">
                Liên hệ học thuật
              </a>
              <button id="printBtn" class="focus-ring inline-flex items-center justify-center rounded-2xl px-5 py-3 text-sm font-medium text-[var(--muted)] hover:text-[var(--ink)]">
                In / PDF
              </button>
            </div>

            <div class="reveal mt-8 grid max-w-2xl grid-cols-2 gap-3 sm:grid-cols-3">
              <div class="rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4">
                <div class="text-xs text-[var(--muted)]">Chuyên ngành</div>
                <div class="mt-1 font-medium" id="heroField">Khoa học dữ liệu</div>
              </div>
              <div class="rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4">
                <div class="text-xs text-[var(--muted)]">Nơi công tác</div>
                <div class="mt-1 font-medium" id="heroWorkplace">Viện/Trường</div>
              </div>
              <div class="rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4">
                <div class="text-xs text-[var(--muted)]">Email</div>
                <div class="mt-1 font-medium truncate" id="heroEmailInline">name@domain.com</div>
              </div>
            </div>
          </div>

          <div class="lg:col-span-5">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6 shadow-[var(--shadow)]">
              <div class="flex items-start justify-between gap-4">
                <div>
                  <div class="text-sm text-[var(--muted)]">Hồ sơ nhanh</div>
                  <div class="mt-1 text-lg font-semibold font-display" id="quickTitle">Hướng nghiên cứu · Công bố · Ứng dụng</div>
                </div>
                <span class="inline-flex items-center rounded-full bg-emerald-500/15 px-3 py-1 text-xs font-medium text-emerald-700 dark:text-emerald-200">Public</span>
              </div>

              <div class="mt-5 flex items-center gap-4">
                <div class="relative">
                  <img id="avatarImg" alt="Ảnh đại diện" class="h-20 w-20 rounded-2xl border border-[var(--border)] object-cover bg-grid" />
                  <div class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-white/15"></div>
                </div>
                <div class="min-w-0">
                  <div class="font-medium" id="cardName">Nguyễn A</div>
                  <div class="mt-1 text-sm text-[var(--muted)]" id="cardDept">Chuyên ngành / Bộ môn</div>
                  <div class="mt-2 flex flex-wrap gap-2" id="heroBadges"></div>
                </div>
              </div>

              <div class="mt-6 rounded-2xl bg-black/5 p-4 dark:bg-white/5">
                <div class="grid gap-3 text-sm">
                  <div class="flex items-center justify-between gap-3">
                    <span class="text-[var(--muted)]">Điện thoại</span>
                    <span class="font-medium" id="phoneInline">+84 9xx xxx xxx</span>
                  </div>
                  <div class="flex items-center justify-between gap-3">
                    <span class="text-[var(--muted)]">Email</span>
                    <a id="emailLink" class="focus-ring rounded-lg px-2 py-1 font-medium hover:bg-white dark:hover:bg-black/40" href="mailto:name@domain.com">name@domain.com</a>
                  </div>
                  <div class="flex items-center justify-between gap-3">
                    <span class="text-[var(--muted)]">Ngày kết nạp Đảng</span>
                    <span class="font-medium" id="partyDateInline">01/01/2020</span>
                  </div>
                </div>

                <div class="mt-4 flex flex-wrap gap-2" id="quickLinks"></div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- PROFILE / PERSONAL INFO -->
    <section id="profile" class="border-t border-[var(--border)]">
      <div class="mx-auto max-w-6xl px-4 py-14 sm:py-18">
        <div class="reveal">
          <h2 class="text-2xl font-semibold tracking-tight font-display">Thông tin cá nhân</h2>
          <p class="mt-2 text-[var(--muted)]">Thông tin hiển thị ở chế độ chỉ xem. Bạn chỉnh sửa nội dung trong phần <b>DATA</b> ở cuối file.</p>
        </div>

        <div class="mt-8 grid gap-6 lg:grid-cols-12">
          <div class="lg:col-span-7">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <div class="flex items-center justify-between gap-4">
                <h3 class="font-semibold font-display">Thông tin liên hệ & công tác</h3>
                <span class="text-xs text-[var(--muted)]">Public profile</span>
              </div>

              <dl class="mt-5 grid gap-4 sm:grid-cols-2 text-sm">
                <div>
                  <dt class="text-[var(--muted)]">Họ tên</dt>
                  <dd class="mt-1 font-medium" id="pName">Nguyễn A</dd>
                </div>
                <div>
                  <dt class="text-[var(--muted)]">Số điện thoại</dt>
                  <dd class="mt-1 font-medium" id="pPhone">+84 9xx xxx xxx</dd>
                </div>
                <div>
                  <dt class="text-[var(--muted)]">Tên chuyên ngành</dt>
                  <dd class="mt-1 font-medium" id="pField">Khoa học dữ liệu</dd>
                </div>
                <div>
                  <dt class="text-[var(--muted)]">Email</dt>
                  <dd class="mt-1 font-medium"><a id="pEmail" class="focus-ring rounded-lg px-2 py-1 hover:bg-white dark:hover:bg-black/40" href="mailto:name@domain.com">name@domain.com</a></dd>
                </div>
                <div class="sm:col-span-2">
                  <dt class="text-[var(--muted)]">Nơi công tác</dt>
                  <dd class="mt-1 font-medium" id="pWorkplace">Viện/Trường</dd>
                </div>
                <div>
                  <dt class="text-[var(--muted)]">Ngày kết nạp Đảng</dt>
                  <dd class="mt-1 font-medium" id="pPartyDate">01/01/2020</dd>
                </div>
                <div>
                  <dt class="text-[var(--muted)]">Địa điểm</dt>
                  <dd class="mt-1 font-medium" id="pLocation">Việt Nam</dd>
                </div>
              </dl>

              <div class="mt-6 rounded-2xl bg-gradient-to-r from-emerald-500/10 via-cyan-400/10 to-blue-500/10 p-4">
                <div class="text-sm font-medium">Ghi chú</div>
                <p class="mt-1 text-sm text-[var(--muted)]" id="pNote">Bạn có thể thêm ORCID, Google Scholar, ResearchGate... để tăng độ tin cậy hồ sơ.</p>
              </div>
            </div>
          </div>

          <div class="lg:col-span-5">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <h3 class="font-semibold font-display">Tóm tắt định hướng</h3>
              <p class="mt-3 text-sm text-[var(--muted)]" id="pSummary">Tập trung nghiên cứu, đào tạo và hợp tác học thuật. Ưu tiên tính minh bạch, tính lặp lại (reproducibility) và tác động thực tiễn.</p>

              <div class="mt-5 grid gap-3">
                <div class="rounded-2xl border border-[var(--border)] p-4">
                  <div class="text-xs text-[var(--muted)]">Hướng nghiên cứu</div>
                  <div class="mt-1 font-medium" id="pFocus">AI ứng dụng · Phân tích dữ liệu · Mô hình dự báo</div>
                </div>
                <div class="rounded-2xl border border-[var(--border)] p-4">
                  <div class="text-xs text-[var(--muted)]">Từ khóa</div>
                  <div class="mt-2 flex flex-wrap gap-2" id="pKeywords"></div>
                </div>
              </div>

              <div class="mt-6 flex flex-wrap gap-2" id="pSocials"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- EDUCATION -->
    <section id="education" class="border-t border-[var(--border)]">
      <div class="mx-auto max-w-6xl px-4 py-14 sm:py-18">
        <div class="reveal flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <h2 class="text-2xl font-semibold tracking-tight font-display">Quá trình học tập</h2>
            <p class="mt-2 text-[var(--muted)]">Hiển thị theo dòng thời gian; dễ mở rộng khi thêm bằng cấp.</p>
          </div>
          <button id="eduToggle" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45">Mở rộng/Thu gọn</button>
        </div>

        <div class="mt-8 grid gap-6 lg:grid-cols-12">
          <div class="lg:col-span-8">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold font-display">Học vấn</h3>
                <span class="text-xs text-[var(--muted)]">Education</span>
              </div>
              <div id="eduList" class="mt-6 grid gap-4"></div>
            </div>
          </div>
          <div class="lg:col-span-4">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <h3 class="font-semibold font-display">Gợi ý trình bày</h3>
              <ul class="mt-4 space-y-2 text-sm text-[var(--muted)]">
                <li class="flex gap-2"><span class="mt-2 h-2 w-2 shrink-0 rounded-full bg-emerald-500"></span><span>GPA/CPA (nếu muốn) và luận văn/đề tài.</span></li>
                <li class="flex gap-2"><span class="mt-2 h-2 w-2 shrink-0 rounded-full bg-cyan-500"></span><span>Nhấn mạnh chuyên ngành và hướng nghiên cứu.</span></li>
                <li class="flex gap-2"><span class="mt-2 h-2 w-2 shrink-0 rounded-full bg-blue-600"></span><span>Thêm chứng nhận, học bổng, giải thưởng nếu có.</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WORK -->
    <section id="work" class="border-t border-[var(--border)]">
      <div class="mx-auto max-w-6xl px-4 py-14 sm:py-18">
        <div class="reveal">
          <h2 class="text-2xl font-semibold tracking-tight font-display">Quá trình làm việc</h2>
          <p class="mt-2 text-[var(--muted)]">Tập trung chức vụ và nhiệm vụ chính (giảng dạy, nghiên cứu, quản lý, chuyển giao...).</p>
        </div>

        <div class="mt-8 grid gap-6 lg:grid-cols-12">
          <div class="lg:col-span-12">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold font-display">Kinh nghiệm</h3>
                <span class="text-xs text-[var(--muted)]">Work history</span>
              </div>
              <div id="workList" class="mt-6 grid gap-4"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SKILLS -->
    <section id="skills" class="border-t border-[var(--border)]">
      <div class="mx-auto max-w-6xl px-4 py-14 sm:py-18">
        <div class="reveal flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <h2 class="text-2xl font-semibold tracking-tight font-display">Kỹ năng</h2>
            <p class="mt-2 text-[var(--muted)]">Chấm theo thang 5 sao; phù hợp trình bày năng lực học thuật & kỹ thuật.</p>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-xs text-[var(--muted)]" for="skillsSearch">Tìm:</label>
            <input id="skillsSearch" type="search" placeholder="VD: Python, thống kê..." class="focus-ring w-64 max-w-[70vw] rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm outline-none placeholder:text-slate-400 dark:bg-black/30 dark:placeholder:text-white/40" />
          </div>
        </div>

        <div class="mt-8 grid gap-6 lg:grid-cols-12">
          <div class="lg:col-span-7">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold font-display">Kỹ năng (5 sao)</h3>
                <span class="text-xs text-[var(--muted)]">Rating</span>
              </div>
              <div id="skillsList" class="mt-6 grid gap-3"></div>
            </div>
          </div>
          <div class="lg:col-span-5">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold font-display">Công cụ sử dụng</h3>
                <span class="text-xs text-[var(--muted)]">Tools</span>
              </div>
              <div id="toolsList" class="mt-5 grid gap-3"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RESEARCH -->
    <section id="research" class="border-t border-[var(--border)]">
      <div class="mx-auto max-w-6xl px-4 py-14 sm:py-18">
        <div class="reveal flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <h2 class="text-2xl font-semibold tracking-tight font-display">Công trình nghiên cứu</h2>
            <p class="mt-2 text-[var(--muted)]">Chia 2 phần: <b>Đề tài</b> và <b>Công bố khoa học</b>. Có tìm kiếm và xem chi tiết.</p>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-xs text-[var(--muted)]" for="researchSearch">Tìm:</label>
            <input id="researchSearch" type="search" placeholder="Từ khóa, năm, tạp chí..." class="focus-ring w-72 max-w-[80vw] rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm outline-none placeholder:text-slate-400 dark:bg-black/30 dark:placeholder:text-white/40" />
          </div>
        </div>

        <div class="mt-8 reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-4">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div class="flex flex-wrap gap-2">
              <button class="rt-btn focus-ring rounded-2xl bg-gradient-to-r from-emerald-600 to-blue-600 px-4 py-2 text-sm font-semibold text-white" data-tab="projects">Đề tài</button>
              <button class="rt-btn focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" data-tab="publications">Công bố khoa học</button>
            </div>
            <div class="text-xs text-[var(--muted)]" id="researchMeta">—</div>
          </div>
        </div>

        <div class="mt-6 grid gap-6 lg:grid-cols-12">
          <div class="lg:col-span-12">
            <div id="researchGrid" class="grid gap-6 lg:grid-cols-2"></div>
          </div>
        </div>

        <div class="mt-8 reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h3 class="font-semibold font-display">Xuất danh mục công trình</h3>
              <p class="mt-1 text-sm text-[var(--muted)]">Bạn có thể in trang hoặc xuất PDF để gửi kèm hồ sơ.</p>
            </div>
            <button id="printResearch" class="focus-ring inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-emerald-600 to-blue-600 px-5 py-3 text-sm font-semibold text-white hover:opacity-95">In / PDF</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="border-t border-[var(--border)]">
      <div class="mx-auto max-w-6xl px-4 py-14 sm:py-18">
        <div class="reveal flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <h2 class="text-2xl font-semibold tracking-tight font-display">Liên hệ</h2>
            <p class="mt-2 text-[var(--muted)]">Form liên hệ tạo email theo mẫu (static-friendly). Bạn có thể thay bằng Formspree/EmailJS khi cần.</p>
          </div>
          <div class="flex items-center gap-2">
            <button id="copyEmailBtn" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45">Sao chép email</button>
          </div>
        </div>

        <div class="mt-8 grid gap-6 lg:grid-cols-12">
          <div class="lg:col-span-5">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <h3 class="font-semibold font-display">Kênh liên hệ</h3>
              <div class="mt-5 grid gap-3">
                <div class="rounded-2xl bg-black/5 p-4 dark:bg-white/5">
                  <div class="text-xs text-[var(--muted)]">Email</div>
                  <div class="mt-1 flex items-center justify-between gap-2">
                    <a id="contactEmail" class="focus-ring rounded-lg px-2 py-1 font-medium hover:bg-white dark:hover:bg-black/40" href="mailto:name@domain.com">name@domain.com</a>
                  </div>
                </div>

                <div class="rounded-2xl bg-black/5 p-4 dark:bg-white/5">
                  <div class="text-xs text-[var(--muted)]">Mạng xã hội học thuật</div>
                  <div id="contactSocials" class="mt-3 flex flex-wrap gap-2"></div>
                </div>

                <div class="rounded-2xl bg-black/5 p-4 dark:bg-white/5">
                  <div class="text-xs text-[var(--muted)]">Gợi ý nội dung</div>
                  <p class="mt-2 text-sm text-[var(--muted)]">Vui lòng nêu rõ mục đích liên hệ (hợp tác nghiên cứu/giảng dạy/hội thảo), thời gian dự kiến và tài liệu liên quan.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="lg:col-span-7">
            <div class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6">
              <div class="flex items-center justify-between gap-3">
                <h3 class="font-semibold font-display">Form liên hệ</h3>
                <span class="text-xs text-[var(--muted)]">mailto template</span>
              </div>
              <form id="contactForm" class="mt-6 grid gap-4">
                <div class="grid gap-4 sm:grid-cols-2">
                  <label class="grid gap-2">
                    <span class="text-sm font-medium">Họ tên</span>
                    <input name="name" id="cfName" autocomplete="name" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-3 text-sm outline-none dark:bg-black/30" placeholder="VD: Trần Minh" required />
                  </label>
                  <label class="grid gap-2">
                    <span class="text-sm font-medium">Email</span>
                    <input name="email" id="cfEmail" type="email" autocomplete="email" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-3 text-sm outline-none dark:bg-black/30" placeholder="ban@domain.com" required />
                  </label>
                </div>

                <label class="grid gap-2">
                  <span class="text-sm font-medium">Chủ đề</span>
                  <input name="subject" id="cfSubject" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-3 text-sm outline-none dark:bg-black/30" placeholder="VD: Hợp tác nghiên cứu / Seminar" required />
                </label>

                <label class="grid gap-2">
                  <span class="text-sm font-medium">Nội dung</span>
                  <textarea name="message" id="cfMessage" rows="6" class="focus-ring resize-y rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-3 text-sm outline-none dark:bg-black/30" placeholder="Mục tiêu, bối cảnh, thời gian, liên kết tài liệu..." required></textarea>
                </label>

                <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                  <div class="text-xs text-[var(--muted)]">Tip: Nhấn “Tạo email” sẽ mở ứng dụng mail của bạn với nội dung đã điền.</div>
                  <div class="flex gap-2">
                    <button type="reset" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45">Xoá</button>
                    <button type="submit" class="focus-ring rounded-2xl bg-gradient-to-r from-emerald-600 to-blue-600 px-5 py-2 text-sm font-semibold text-white hover:opacity-95">Tạo email</button>
                  </div>
                </div>

                <p id="contactFormHint" class="hidden text-sm"></p>
              </form>
            </div>
          </div>
        </div>

        <footer class="mt-12 border-t border-[var(--border)] pt-8 text-sm text-[var(--muted)]">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <span>© <span id="year"></span> </span>
              <span id="footerName" class="font-display">Nguyễn A</span>
              <span> · Hồ sơ khoa học cá nhân.</span>
            </div>
            <div class="flex items-center gap-3">
              <button id="ownerUnlock" class="focus-ring rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10" title="Mở Owner mode (chỉ trên máy của bạn)">Owner</button>
              <a class="focus-ring rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10" href="#home">Lên đầu trang</a>
              <a class="focus-ring rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10" href="#research">Công trình</a>
              <a class="focus-ring rounded-lg px-2 py-1 hover:bg-black/5 dark:hover:bg-white/10" href="#contact">Liên hệ</a>
            </div>
          </div>
        </footer>
      </div>
    </section>
  </main>

  <!-- Back to top -->
  <button id="toTop" class="fixed bottom-5 right-5 hidden focus-ring rounded-2xl border border-[var(--border)] bg-white/80 px-4 py-3 text-sm shadow-sm hover:bg-white dark:bg-black/35 dark:hover:bg-black/50" aria-label="Lên đầu trang">
    ↑ Lên đầu
  </button>

  <!-- MODALS -->
  <div id="modalOverlay" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/55 backdrop-blur-sm"></div>

    <div class="relative mx-auto flex min-h-dvh max-w-4xl items-end p-4 sm:items-center">
      <div class="w-full overflow-hidden rounded-3xl border border-[var(--border)] bg-[var(--card)] shadow-xl">
        <div class="flex items-center justify-between border-b border-[var(--border)] p-4">
          <div>
            <div id="modalKicker" class="text-xs text-[var(--muted)]">Chi tiết</div>
            <h3 id="modalTitle" class="mt-1 text-base font-semibold font-display">Tiêu đề</h3>
          </div>
          <button id="modalClose" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-3 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" aria-label="Đóng">Đóng</button>
        </div>
        <div class="max-h-[70vh] overflow-auto p-5">
          <div id="modalBody" class="prose prose-slate max-w-none dark:prose-invert"></div>
        </div>
        <div id="modalFooter" class="hidden border-t border-[var(--border)] p-4"></div>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="fixed inset-x-0 bottom-4 z-[70] hidden px-4">
    <div class="mx-auto max-w-2xl rounded-2xl border border-[var(--border)] bg-white/90 p-3 text-sm text-slate-800 shadow-lg backdrop-blur dark:bg-black/50 dark:text-white/85">
      <div class="flex items-center justify-between gap-3">
        <div id="toastMsg">Đã sao chép.</div>
        <button id="toastClose" class="focus-ring rounded-xl border border-[var(--border)] bg-white/60 px-3 py-1.5 text-xs hover:bg-white dark:bg-black/30 dark:hover:bg-black/45">OK</button>
      </div>
    </div>
  </div>

  <!-- JSON-LD -->
  <script type="application/ld+json" id="ldJson"></script>

  <script>
    // =====================
    // DATA (CHỈNH SỬA TẠI ĐÂY)
    // =====================
    // LƯU Ý QUAN TRỌNG:
    // - Người truy cập sẽ chỉ xem (không có UI chỉnh sửa). Bạn chỉnh sửa bằng cách sửa DATA trong code và push lên GitHub.
    // - Ảnh đại diện:
    //   (A) Cách chuẩn để ai cũng thấy: commit file ảnh vào repo (vd: avatar.jpg) rồi đặt profile.avatarUrl = './avatar.jpg'
    //   (B) Cách nhanh trên máy bạn: bật Owner mode và upload ảnh (lưu localStorage, chỉ trên trình duyệt của bạn).

    const DATA = {
      profile: {
        name: "Quách Vĩnh",
        initials: "NA",
        role: "Quản lý Tài nguyên và Môi trường",
        slogan: "Nghiên cứu dựa trên dữ liệu, hướng tới tác động thực tiễn và chuẩn mực học thuật.",
        status: "Hồ sơ khoa học cá nhân — cập nhật thường xuyên",
        field: "Quản lý Môi trường",
        workplace: "Đại học Cần Thơ",
        location: "Cần Thơ, Việt Nam",
        phone: "0783 141 003",
        email: "qv14102003@gmail.com",
        partyJoinDate: "25/10/2024",
        // commit ảnh vào repo và trỏ đường dẫn tương đối (vd: './avatar.jpg')
        avatarUrl: "",
        quickTitle: "Hướng nghiên cứu · Công bố · Ứng dụng",
        focus: "Môi trường nước mặt · Nguồn gây ô nhiểm · Luật và Chính sách Bảo vệ môi trường",
        note: "Bạn có thể thêm ORCID, Google Scholar, ResearchGate... để tăng độ tin cậy hồ sơ.",
        summary: "Tập trung nghiên cứu và hợp tác học thuật. Ưu tiên tính minh bạch, tính lặp lại (reproducibility) và tác động thực tiễn.",
        keywords: ["Water Quality", "Water Resource Management", "Pollution Sources", "Environmental Law", "Environmental Governance"],
        badges: ["ORCID", "Google Scholar", "Scopus", "Web of Science"],
        socials: [
          { label: "ORCID", href: "https://orcid.org/", note: "ID học thuật" },
          { label: "Google Scholar", href: "https://scholar.google.com/", note: "Trích dẫn" },
          { label: "ResearchGate", href: "https://www.researchgate.net/", note: "Hợp tác" },
          { label: "GitHub", href: "https://github.com/", note: "Mã nguồn" }
        ],
        links: [
          { label: "CV (PDF)", href: "#" },
          { label: "Scholar", href: "#" },
          { label: "Lab/Group", href: "#" }
        ]
      },

      education: [
        {
          school: "Đại học Cần Thơ",
          start: "2021",
          end: "2025",
          gpa: "3.72/4.00",
          thesis: "Luận văn: Đánh giá diễn biến chất lượng nước mặt tại huyện Châu Phú, tỉnh An Giang giai đoạn 2021 - 2023",
          postgraduate: "Đại học"
        },
        {
          school: "Đại học Cần Thơ",
          start: "2025",
          end: "2027",
          gpa: "X.XX/4.00",
          thesis: "Luận văn Thạc sĩ: *Đang nghiên cứu*",
          postgraduate: "Thạc sĩ (Đang học)"
        },
        
      ],

      work: [
        {
          org: "Trung tâm xét nghiệm huyết thống ADN GENE ID - Cần Thơ",
          start: "05/2025",
          end: "Hiện tại",
          title: "Kỹ thuật viên thu mẫu",
          desc: " "
        },
        {
          org: "Công ty TNHH Xây dựng – Công nghệ Môi trường NANO",
          start: "01/2025",
          end: "04/2025",
          title: "Nghiên cứu viên",
          desc: "Phân tích dữ liệu, xây dựng mô hình, thử nghiệm, viết báo cáo và chuyển giao kết quả."
        }
      ],

      skills: [
        { name: "Python", rating: 5 },
        { name: "Thống kê & Phân tích dữ liệu", rating: 4 },
        { name: "Tin học", rating: 4 },
        { name: "Viết bài báo khoa học", rating: 4 },
        { name: "Thuyết trình học thuật", rating: 4 }
      ],

      tools: [
        { group: "Phân tích", items: ["Python", "R", "Jupyter", "Pandas", "NumPy"] },
        { group: "ML/AI", items: ["scikit-learn", "PyTorch", "TensorFlow"] },
        { group: "Viết & trích dẫn", items: ["LaTeX", "Overleaf", "Zotero/Mendeley"] },
        { group: "Hợp tác", items: ["Git", "GitHub", "Notion"] }
      ],

      research: {
        projects: [
          {
            id: "pr1",
            title: "Đề tài cấp cơ sở: Ứng dụng AI trong ...",
            year: "2024",
            role: "Chủ nhiệm",
            org: "Trường/Viện (Ví dụ)",
            summary: "Xây dựng mô hình dự báo và hệ thống phân tích nhằm hỗ trợ ra quyết định.",
            outcomes: ["Bộ dữ liệu chuẩn hóa", "Mô hình baseline + cải tiến", "Báo cáo nghiệm thu"],
            links: [
              { label: "Tóm tắt", href: "#" },
              { label: "Mã nguồn", href: "#" }
            ]
          },
          {
            id: "pr2",
            title: "Đề tài hợp tác: Tối ưu hóa quy trình ...",
            year: "2023",
            role: "Thành viên",
            org: "Doanh nghiệp/Đối tác (Ví dụ)",
            summary: "Ứng dụng tối ưu hóa và mô phỏng để nâng cao hiệu quả vận hành.",
            outcomes: ["Giảm thời gian xử lý", "Khuyến nghị vận hành", "Dashboard theo dõi"],
            links: [
              { label: "Bản trình bày", href: "#" }
            ]
          }
        ],
        publications: [
          {
            id: "pb1",
            title: "A Cold-Start Approach for ...",
            year: "2025",
            venue: "Journal of Example Science",
            type: "ISI/Scopus",
            authors: "Nguyễn Văn A, Trần B, ...",
            doi: "10.0000/example.2025.0001",
            summary: "Đề xuất phương pháp ... và đánh giá trên dữ liệu ...",
            links: [
              { label: "DOI", href: "https://doi.org/10.0000/example.2025.0001" },
              { label: "PDF", href: "#" }
            ]
          },
          {
            id: "pb2",
            title: "Efficient Optimization for ...",
            year: "2024",
            venue: "Proceedings of Example Conference",
            type: "Conference",
            authors: "Nguyễn Văn A, ...",
            doi: "",
            summary: "Trình bày ...; so sánh với baseline ...",
            links: [
              { label: "Trang bài", href: "#" }
            ]
          }
        ]
      },

      contact: {
        email: "name@domain.com",
        socials: [
          { label: "ORCID", href: "https://orcid.org/", note: "ID học thuật" },
          { label: "Google Scholar", href: "https://scholar.google.com/", note: "Trích dẫn" },
          { label: "ResearchGate", href: "https://www.researchgate.net/", note: "Hợp tác" },
          { label: "LinkedIn", href: "https://www.linkedin.com/", note: "Kết nối" }
        ]
      }
    };

    // =====================
    // HELPERS
    // =====================
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    function toast(msg) {
      const t = $('#toast');
      $('#toastMsg').textContent = msg;
      t.classList.remove('hidden');
      clearTimeout(toast._timer);
      toast._timer = setTimeout(() => t.classList.add('hidden'), 3200);
    }

    function setActiveNav(hash) {
      const links = $$('[data-nav]');
      links.forEach(a => {
        const active = a.getAttribute('href') === hash;
        a.classList.toggle('bg-black/5', active);
        a.classList.toggle('text-[var(--ink)]', active);
        a.classList.toggle('dark:bg-white/10', active);
        a.classList.toggle('dark:text-white', active);
        a.setAttribute('aria-current', active ? 'page' : 'false');
      });
    }

    function renderThemeIcon() {
      const isDark = document.documentElement.classList.contains('dark');
      $('#themeIcon').innerHTML = isDark
        ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/></svg>`
        : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>`;
    }

    function toggleTheme() {
      const html = document.documentElement;
      const isDark = html.classList.toggle('dark');
      try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch(e) {}
      renderThemeIcon();
    }

    function wireReveal(root=document) {
      const items = $$('.reveal', root).filter(el => !el.classList.contains('is-visible'));
      if (!items.length) return;
      if (!('IntersectionObserver' in window)) {
        items.forEach(el => el.classList.add('is-visible'));
        return;
      }
      const io = new IntersectionObserver((entries) => {
        entries.forEach(en => {
          if (en.isIntersecting) {
            en.target.classList.add('is-visible');
            io.unobserve(en.target);
          }
        });
      }, { threshold: 0.12 });
      items.forEach(el => io.observe(el));
    }

    function wireSectionObserver() {
      const ids = ['#home', '#profile', '#education', '#work', '#skills', '#research', '#contact'];
      const sections = ids.map(id => $(id)).filter(Boolean);
      if (!('IntersectionObserver' in window)) return;

      const io = new IntersectionObserver((entries) => {
        const visible = entries
          .filter(e => e.isIntersecting)
          .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
        if (visible) setActiveNav('#' + visible.target.id);
      }, { rootMargin: '-30% 0px -60% 0px', threshold: [0.1, 0.2, 0.35, 0.5] });

      sections.forEach(s => io.observe(s));
    }

    // =====================
    // MODAL
    // =====================
    function openModal({ kicker = "Chi tiết", title = "", bodyHtml = "", footerHtml = "" }) {
      $('#modalKicker').textContent = kicker;
      $('#modalTitle').textContent = title;
      $('#modalBody').innerHTML = bodyHtml;
      const foot = $('#modalFooter');
      if (footerHtml) {
        foot.innerHTML = footerHtml;
        foot.classList.remove('hidden');
      } else {
        foot.innerHTML = '';
        foot.classList.add('hidden');
      }
      $('#modalOverlay').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      $('#modalClose').focus();
    }

    function closeModal() {
      $('#modalOverlay').classList.add('hidden');
      document.body.style.overflow = '';
    }

    // =====================
    // OWNER MODE (UI upload avatar only)
    // =====================
    // Đây KHÔNG phải bảo mật thật. Nó chỉ ẩn UI chỉnh trên trình duyệt.
    // Nếu bạn cần phân quyền thật, phải có backend/auth.
    const OWNER_KEY = 'owner_unlocked_v1';
    const AVATAR_KEY = 'scientist_avatar_v1';
    // Đổi passphrase này trong code của bạn
    const OWNER_PASSPHRASE = 'change-this-passphrase';

    function isOwnerUnlocked() {
      try { return localStorage.getItem(OWNER_KEY) === '1'; } catch(e) { return false; }
    }

    function setOwnerUnlocked(v) {
      try { localStorage.setItem(OWNER_KEY, v ? '1' : '0'); } catch(e) {}
      applyOwnerUI();
    }

    function applyOwnerUI() {
      const on = isOwnerUnlocked();
      $('#ownerPanelBtn').classList.toggle('hidden', !on);
      $('#ownerBadge').classList.toggle('hidden', !on);
    }

    function unlockOwnerPrompt() {
      const pass = prompt('Nhập passphrase để bật Owner mode (chỉ trên trình duyệt này):');
      if (!pass) return;
      if (pass === OWNER_PASSPHRASE) {
        setOwnerUnlocked(true);
        toast('Owner mode đã bật.');
      } else {
        toast('Sai passphrase.');
      }
    }

    function openOwnerPanel() {
      const current = getAvatarSrc();
      const body = `
        <div class="rounded-2xl border border-[var(--border)] bg-black/5 p-5 dark:bg-white/5">
          <div class="text-xs text-[var(--muted)]">Cài đặt Owner (local)</div>
          <div class="mt-3 grid gap-4 sm:grid-cols-2">
            <div>
              <div class="text-sm font-medium">Ảnh đại diện</div>
              <p class="mt-1 text-xs text-[var(--muted)]">Upload sẽ lưu vào localStorage (chỉ trên máy bạn). Để ảnh hiển thị cho mọi người, hãy commit ảnh vào repo và đặt <code>profile.avatarUrl</code>.</p>
              <div class="mt-3 flex items-center gap-3">
                <img src="${escapeHtml(current)}" alt="avatar" class="h-20 w-20 rounded-2xl border border-[var(--border)] object-cover bg-grid" />
                <div class="grid gap-2">
                  <input id="avatarFile" type="file" accept="image/*" class="block w-full text-sm" />
                  <div class="flex flex-wrap gap-2">
                    <button id="removeAvatar" class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" type="button">Xoá avatar local</button>
                    <button id="lockOwner" class="focus-ring rounded-2xl bg-gradient-to-r from-emerald-600 to-blue-600 px-4 py-2 text-sm font-semibold text-white hover:opacity-95" type="button">Tắt Owner mode</button>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <div class="text-sm font-medium">Gợi ý GitHub</div>
              <ol class="mt-2 text-sm text-[var(--muted)] list-decimal pl-5 space-y-1">
                <li>Thêm file ảnh vào repo (vd: <code>avatar.jpg</code>).</li>
                <li>Đặt <code>profile.avatarUrl = './avatar.jpg'</code> trong DATA.</li>
                <li>Commit & push lên GitHub Pages để ai cũng thấy.</li>
              </ol>
            </div>
          </div>
        </div>
      `;

      openModal({ kicker: 'Owner panel', title: 'Thiết lập nhanh', bodyHtml: body });

      setTimeout(() => {
        const input = $('#avatarFile');
        const remove = $('#removeAvatar');
        const lock = $('#lockOwner');

        if (input) {
          input.addEventListener('change', async () => {
            const file = input.files && input.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
              toast('Vui lòng chọn file ảnh.');
              return;
            }
            const dataUrl = await readFileAsDataURL(file);
            try { localStorage.setItem(AVATAR_KEY, dataUrl); } catch(e) {}
            applyAvatar();
            toast('Đã cập nhật avatar (local).');
            closeModal();
          });
        }

        if (remove) {
          remove.addEventListener('click', () => {
            try { localStorage.removeItem(AVATAR_KEY); } catch(e) {}
            applyAvatar();
            toast('Đã xoá avatar local.');
            closeModal();
          });
        }

        if (lock) {
          lock.addEventListener('click', () => {
            setOwnerUnlocked(false);
            toast('Owner mode đã tắt.');
            closeModal();
          });
        }
      }, 0);
    }

    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const fr = new FileReader();
        fr.onload = () => resolve(String(fr.result || ''));
        fr.onerror = reject;
        fr.readAsDataURL(file);
      });
    }

    function defaultAvatarDataURI(initials='NA') {
      const safe = encodeURIComponent(initials.trim().slice(0, 3).toUpperCase());
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop stop-color="#16a34a"/>
              <stop offset="0.5" stop-color="#22d3ee"/>
              <stop offset="1" stop-color="#2563eb"/>
            </linearGradient>
          </defs>
          <rect width="160" height="160" rx="36" fill="#0b1220"/>
          <rect x="12" y="12" width="136" height="136" rx="30" fill="url(#g)" opacity="0.20"/>
          <text x="50%" y="52%" dominant-baseline="middle" text-anchor="middle" font-family="Sora,Inter,Arial" font-size="44" font-weight="700" fill="#eaf2ff">${initials}</text>
          <path d="M30 118c20 18 80 18 100 0" stroke="url(#g)" stroke-width="6" fill="none" stroke-linecap="round" opacity="0.85"/>
        </svg>
      `.trim();
      return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`;
    }

    function getAvatarSrc() {
      // Priority: owner local upload -> profile.avatarUrl -> generated placeholder
      try {
        const local = localStorage.getItem(AVATAR_KEY);
        if (local) return local;
      } catch(e) {}
      if (DATA.profile.avatarUrl) return DATA.profile.avatarUrl;
      return defaultAvatarDataURI(DATA.profile.initials || 'NA');
    }

    function applyAvatar() {
      const src = getAvatarSrc();
      $('#avatarImg').src = src;
    }

    // =====================
    // RENDER
    // =====================
    function renderProfile() {
      const p = DATA.profile;

      // Brand
      $('#brandInitials').textContent = p.initials || 'NA';
      $('#brandName').textContent = p.name;
      $('#brandRole').textContent = p.role;

      // Hero
      $('#heroStatus').textContent = p.status;
      $('#heroName').textContent = p.name;
      $('#heroRole').textContent = p.role;
      $('#heroSlogan').textContent = p.slogan;
      $('#heroField').textContent = p.field;
      $('#heroWorkplace').textContent = p.workplace;
      $('#heroEmailInline').textContent = p.email;

      // Card
      $('#quickTitle').textContent = p.quickTitle;
      $('#cardName').textContent = p.name;
      $('#cardDept').textContent = p.field;
      $('#phoneInline').textContent = p.phone;
      $('#partyDateInline').textContent = p.partyJoinDate;
      $('#emailLink').textContent = p.email;
      $('#emailLink').href = `mailto:${p.email}`;

      // Personal section
      $('#pName').textContent = p.name;
      $('#pPhone').textContent = p.phone;
      $('#pField').textContent = p.field;
      $('#pEmail').textContent = p.email;
      $('#pEmail').href = `mailto:${p.email}`;
      $('#pWorkplace').textContent = p.workplace;
      $('#pPartyDate').textContent = p.partyJoinDate;
      $('#pLocation').textContent = p.location;
      $('#pNote').textContent = p.note;
      $('#pSummary').textContent = p.summary;
      $('#pFocus').textContent = p.focus;

      // Footer
      $('#footerName').textContent = p.name;

      // Badges
      $('#heroBadges').innerHTML = (p.badges || []).map(b => `
        <span class="inline-flex items-center rounded-full border border-[var(--border)] bg-white/60 px-3 py-1 text-xs text-[var(--muted)] dark:bg-black/30">${escapeHtml(b)}</span>
      `).join('');

      // Quick links
      $('#quickLinks').innerHTML = (p.links || []).map(l => `
        <a class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-3 py-2 text-xs font-medium hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" href="${escapeHtml(l.href)}" target="_blank" rel="noreferrer">${escapeHtml(l.label)}</a>
      `).join('');

      // Keywords
      $('#pKeywords').innerHTML = (p.keywords || []).map(k => `
        <span class="inline-flex items-center rounded-full bg-black/5 px-3 py-1 text-xs text-[var(--muted)] dark:bg-white/5">${escapeHtml(k)}</span>
      `).join('');

      // Socials (profile)
      $('#pSocials').innerHTML = (p.socials || []).map(s => `
        <a class="focus-ring inline-flex items-center gap-2 rounded-2xl border border-[var(--border)] bg-white/60 px-3 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" href="${escapeHtml(s.href)}" target="_blank" rel="noreferrer">
          <span class="font-medium">${escapeHtml(s.label)}</span>
          <span class="text-xs text-[var(--muted)]">${escapeHtml(s.note || '')}</span>
        </a>
      `).join('');

      // Contact
      $('#contactEmail').textContent = DATA.contact.email;
      $('#contactEmail').href = `mailto:${DATA.contact.email}`;
      $('#contactSocials').innerHTML = (DATA.contact.socials || []).map(s => `
        <a class="focus-ring inline-flex items-center gap-2 rounded-2xl border border-[var(--border)] bg-white/60 px-3 py-2 text-sm hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" href="${escapeHtml(s.href)}" target="_blank" rel="noreferrer">
          <span class="font-medium">${escapeHtml(s.label)}</span>
          <span class="text-xs text-[var(--muted)]">${escapeHtml(s.note || '')}</span>
        </a>
      `).join('');

      // JSON-LD
      const ld = {
        "@context": "https://schema.org",
        "@type": "Person",
        name: p.name,
        jobTitle: p.role,
        email: p.email,
        affiliation: p.workplace,
        url: (location && location.href) ? location.href : undefined,
        sameAs: (p.socials || []).map(x => x.href)
      };
      $('#ldJson').textContent = JSON.stringify(ld, null, 2);

      applyAvatar();
    }

    function renderEducation() {
      const list = DATA.education || [];
      $('#eduList').innerHTML = list.map((e, idx) => `
        <details class="edu-item group rounded-3xl border border-[var(--border)] bg-white/60 p-5 open:bg-black/5 dark:bg-black/30 dark:open:bg-white/5" ${idx === 0 ? 'open' : ''}>
          <summary class="cursor-pointer list-none select-none">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="font-medium">${escapeHtml(e.postgraduate || 'Học vấn')}</div>
                <div class="mt-1 text-sm text-[var(--muted)]">${escapeHtml(e.school)}</div>
                <div class="mt-2 inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500/15 to-blue-500/15 px-3 py-1 text-xs text-[var(--muted)]">
                  <span>${escapeHtml(e.start)} – ${escapeHtml(e.end)}</span>
                  <span class="opacity-60">•</span>
                  <span>GPA: ${escapeHtml(e.gpa || '—')}</span>
                </div>
              </div>
              <span class="text-xs font-medium text-[var(--muted)]">Chi tiết</span>
            </div>
          </summary>
          <div class="mt-4 rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4">
            <div class="text-xs text-[var(--muted)]">Luận văn / Nghiên cứu</div>
            <div class="mt-1 text-sm">${escapeHtml(e.thesis || '—')}</div>
          </div>
        </details>
      `).join('');
    }

    function renderWork() {
      const list = DATA.work || [];
      $('#workList').innerHTML = list.map(w => `
        <div class="rounded-3xl border border-[var(--border)] bg-white/60 p-5 dark:bg-black/30">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <div class="font-medium">${escapeHtml(w.title)}</div>
              <div class="mt-1 text-sm text-[var(--muted)]">${escapeHtml(w.org)}</div>
            </div>
            <div class="inline-flex items-center rounded-full bg-gradient-to-r from-emerald-500/15 to-blue-500/15 px-3 py-1 text-xs text-[var(--muted)]">
              ${escapeHtml(w.start)} – ${escapeHtml(w.end)}
            </div>
          </div>
          <p class="mt-3 text-sm text-[var(--muted)]">${escapeHtml(w.desc)}</p>
        </div>
      `).join('');
    }

    function stars(rating) {
      const r = Math.max(0, Math.min(5, Number(rating) || 0));
      const full = Math.round(r);
      const items = Array.from({length: 5}).map((_, i) => {
        const on = i < full;
        return `<svg class="h-4 w-4 ${on ? 'text-cyan-500' : 'text-slate-300 dark:text-white/20'}" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`;
      }).join('');
      return `<div class="flex items-center gap-1" aria-label="${full} trên 5">${items}</div>`;
    }

    let state = {
      skillsQuery: '',
      researchTab: 'projects',
      researchQuery: ''
    };

    function renderSkills() {
      const q = (state.skillsQuery || '').trim().toLowerCase();
      const list = (DATA.skills || []).filter(s => {
        const hay = `${s.name} ${s.rating}`.toLowerCase();
        return !q || hay.includes(q);
      });

      $('#skillsList').innerHTML = list.map(s => `
        <div class="flex items-center justify-between gap-4 rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-3 dark:bg-black/30">
          <div class="min-w-0">
            <div class="font-medium">${escapeHtml(s.name)}</div>
            <div class="mt-1 text-xs text-[var(--muted)]">Thang điểm 5 sao</div>
          </div>
          ${stars(s.rating)}
        </div>
      `).join('') || `
        <div class="rounded-2xl border border-[var(--border)] bg-white/60 p-4 text-sm text-[var(--muted)] dark:bg-black/30">Không có kỹ năng phù hợp.</div>
      `;

      $('#toolsList').innerHTML = (DATA.tools || []).map(g => `
        <div class="rounded-2xl border border-[var(--border)] p-4">
          <div class="text-sm font-medium">${escapeHtml(g.group)}</div>
          <div class="mt-3 flex flex-wrap gap-2">
            ${(g.items || []).map(it => `
              <span class="inline-flex items-center rounded-full bg-black/5 px-3 py-1 text-xs text-[var(--muted)] dark:bg-white/5">${escapeHtml(it)}</span>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    function researchCardProject(p) {
      const outcomes = (p.outcomes || []).map(o => `<li class="flex gap-2"><span class="mt-2 h-2 w-2 rounded-full bg-gradient-to-r from-emerald-500 to-blue-600"></span><span>${escapeHtml(o)}</span></li>`).join('');
      const links = (p.links || []).map(l => `
        <a class="focus-ring rounded-xl border border-[var(--border)] bg-white/60 px-3 py-2 text-xs font-medium hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" href="${escapeHtml(l.href)}" target="_blank" rel="noreferrer">${escapeHtml(l.label)}</a>
      `).join('');

      return `
        <article class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-5 shadow-[var(--shadow)]">
          <div class="rounded-2xl border border-[var(--border)] bg-grid p-5">
            <div class="flex items-center justify-between gap-4">
              <span class="inline-flex items-center rounded-full bg-gradient-to-r from-emerald-500/15 to-blue-500/15 px-3 py-1 text-xs text-[var(--muted)]">Đề tài · ${escapeHtml(p.year)}</span>
              <span class="text-xs text-[var(--muted)]">${escapeHtml(p.role)}</span>
            </div>
            <h3 class="mt-4 text-lg font-semibold font-display">${escapeHtml(p.title)}</h3>
            <p class="mt-2 text-sm text-[var(--muted)]">${escapeHtml(p.summary || '')}</p>
            <div class="mt-3 text-xs text-[var(--muted)]">Đơn vị: <b>${escapeHtml(p.org || '—')}</b></div>
          </div>

          <div class="mt-4 rounded-2xl bg-black/5 p-4 text-sm text-[var(--muted)] dark:bg-white/5">
            <div class="text-xs font-medium text-[var(--muted)]">Kết quả</div>
            <ul class="mt-2 space-y-2">${outcomes || '<li>—</li>'}</ul>
          </div>

          <div class="mt-4 flex flex-wrap gap-2">
            <button class="open-research focus-ring rounded-2xl bg-gradient-to-r from-emerald-600 to-blue-600 px-4 py-2 text-xs font-semibold text-white hover:opacity-95" data-kind="projects" data-id="${escapeHtml(p.id)}">Xem chi tiết</button>
            ${links}
          </div>
        </article>
      `;
    }

    function researchCardPub(p) {
      const links = (p.links || []).map(l => `
        <a class="focus-ring rounded-xl border border-[var(--border)] bg-white/60 px-3 py-2 text-xs font-medium hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" href="${escapeHtml(l.href)}" target="_blank" rel="noreferrer">${escapeHtml(l.label)}</a>
      `).join('');

      const doi = p.doi ? `<div class="mt-2 text-xs text-[var(--muted)]">DOI: <code>${escapeHtml(p.doi)}</code></div>` : '';

      return `
        <article class="reveal rounded-3xl border border-[var(--border)] bg-[var(--card)] p-5 shadow-[var(--shadow)]">
          <div class="rounded-2xl border border-[var(--border)] bg-grid p-5">
            <div class="flex items-center justify-between gap-4">
              <span class="inline-flex items-center rounded-full bg-gradient-to-r from-emerald-500/15 to-blue-500/15 px-3 py-1 text-xs text-[var(--muted)]">Công bố · ${escapeHtml(p.year)}</span>
              <span class="text-xs text-[var(--muted)]">${escapeHtml(p.type || 'Publication')}</span>
            </div>
            <h3 class="mt-4 text-lg font-semibold font-display">${escapeHtml(p.title)}</h3>
            <div class="mt-2 text-sm text-[var(--muted)]">${escapeHtml(p.venue || '')}</div>
            <div class="mt-2 text-xs text-[var(--muted)]">Tác giả: ${escapeHtml(p.authors || '')}</div>
            ${doi}
          </div>

          <p class="mt-4 text-sm text-[var(--muted)]">${escapeHtml(p.summary || '')}</p>

          <div class="mt-4 flex flex-wrap gap-2">
            <button class="open-research focus-ring rounded-2xl bg-gradient-to-r from-emerald-600 to-blue-600 px-4 py-2 text-xs font-semibold text-white hover:opacity-95" data-kind="publications" data-id="${escapeHtml(p.id)}">Xem chi tiết</button>
            ${links}
          </div>
        </article>
      `;
    }

    function applyResearchFilter() {
      const q = (state.researchQuery || '').trim().toLowerCase();
      const kind = state.researchTab;
      const list = (DATA.research && DATA.research[kind]) ? DATA.research[kind] : [];

      const filtered = list.filter(item => {
        const hay = JSON.stringify(item).toLowerCase();
        return !q || hay.includes(q);
      });

      $('#researchMeta').textContent = `${filtered.length}/${list.length} mục`;

      const html = filtered.map(item => {
        return kind === 'projects' ? researchCardProject(item) : researchCardPub(item);
      }).join('') || `
        <div class="reveal lg:col-span-2 rounded-3xl border border-[var(--border)] bg-[var(--card)] p-6 text-sm text-[var(--muted)]">
          Không tìm thấy công trình phù hợp. Hãy thử từ khóa khác.
        </div>
      `;

      $('#researchGrid').innerHTML = html;
      wireReveal($('#research'));
      wireResearchButtons();
    }

    function setResearchTab(tab) {
      state.researchTab = tab;
      $$('.rt-btn').forEach(b => {
        const active = b.getAttribute('data-tab') === tab;
        b.classList.toggle('bg-gradient-to-r', active);
        b.classList.toggle('from-emerald-600', active);
        b.classList.toggle('to-blue-600', active);
        b.classList.toggle('text-white', active);
        b.classList.toggle('font-semibold', active);

        if (!active) {
          b.classList.add('border', 'border-[var(--border)]', 'bg-white/60');
          b.classList.remove('text-white');
        } else {
          b.classList.remove('border', 'border-[var(--border)]', 'bg-white/60');
        }
      });
      applyResearchFilter();
    }

    function wireResearchButtons() {
      $$('.open-research').forEach(btn => {
        btn.addEventListener('click', () => {
          const kind = btn.getAttribute('data-kind');
          const id = btn.getAttribute('data-id');
          const item = (DATA.research && DATA.research[kind]) ? DATA.research[kind].find(x => x.id === id) : null;
          if (!item) return;

          if (kind === 'projects') {
            const body = `
              <div class="rounded-2xl border border-[var(--border)] bg-grid p-5">
                <div class="flex flex-wrap gap-2">
                  <span class="inline-flex items-center rounded-full bg-gradient-to-r from-emerald-500/15 to-blue-500/15 px-3 py-1 text-xs text-[var(--muted)]">Đề tài</span>
                  <span class="inline-flex items-center rounded-full border border-[var(--border)] bg-white/60 px-3 py-1 text-xs text-[var(--muted)] dark:bg-black/30">Năm: ${escapeHtml(item.year)}</span>
                  <span class="inline-flex items-center rounded-full border border-[var(--border)] bg-white/60 px-3 py-1 text-xs text-[var(--muted)] dark:bg-black/30">Vai trò: ${escapeHtml(item.role)}</span>
                </div>
                <div class="mt-3 text-sm text-[var(--muted)]">Đơn vị: <b>${escapeHtml(item.org || '—')}</b></div>
              </div>

              <h4 class="mt-6">Tóm tắt</h4>
              <p>${escapeHtml(item.summary || '')}</p>

              <h4 class="mt-4">Kết quả</h4>
              <ul>${(item.outcomes || []).map(o => `<li>${escapeHtml(o)}</li>`).join('') || '<li>—</li>'}</ul>

              <p class="mt-4 text-sm text-[var(--muted)]">Gợi ý: bạn có thể bổ sung kinh phí, thời gian, đối tác, link nghiệm thu, tài liệu mở.</p>
            `;

            const footer = `
              <div class="flex flex-wrap gap-2 justify-end">
                ${(item.links || []).map(l => `
                  <a class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm font-medium hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" href="${escapeHtml(l.href)}" target="_blank" rel="noreferrer">${escapeHtml(l.label)}</a>
                `).join('')}
              </div>
            `;

            openModal({ kicker: 'Đề tài', title: item.title, bodyHtml: body, footerHtml: footer });
          } else {
            const doi = item.doi ? `<p><b>DOI:</b> <code>${escapeHtml(item.doi)}</code></p>` : '';
            const body = `
              <div class="rounded-2xl border border-[var(--border)] bg-grid p-5">
                <div class="flex flex-wrap gap-2">
                  <span class="inline-flex items-center rounded-full bg-gradient-to-r from-emerald-500/15 to-blue-500/15 px-3 py-1 text-xs text-[var(--muted)]">Công bố</span>
                  <span class="inline-flex items-center rounded-full border border-[var(--border)] bg-white/60 px-3 py-1 text-xs text-[var(--muted)] dark:bg-black/30">Năm: ${escapeHtml(item.year)}</span>
                  <span class="inline-flex items-center rounded-full border border-[var(--border)] bg-white/60 px-3 py-1 text-xs text-[var(--muted)] dark:bg-black/30">Loại: ${escapeHtml(item.type || '—')}</span>
                </div>
                <div class="mt-3 text-sm text-[var(--muted)]">${escapeHtml(item.venue || '')}</div>
                <div class="mt-2 text-xs text-[var(--muted)]">Tác giả: ${escapeHtml(item.authors || '')}</div>
              </div>

              <h4 class="mt-6">Tóm tắt</h4>
              <p>${escapeHtml(item.summary || '')}</p>

              <h4 class="mt-4">Thông tin</h4>
              ${doi}

              <p class="mt-4 text-sm text-[var(--muted)]">Gợi ý: bổ sung chỉ số trích dẫn, Q-rank, link dữ liệu/mã nguồn (nếu có).</p>
            `;

            const footer = `
              <div class="flex flex-wrap gap-2 justify-end">
                ${(item.links || []).map(l => `
                  <a class="focus-ring rounded-2xl border border-[var(--border)] bg-white/60 px-4 py-2 text-sm font-medium hover:bg-white dark:bg-black/30 dark:hover:bg-black/45" href="${escapeHtml(l.href)}" target="_blank" rel="noreferrer">${escapeHtml(l.label)}</a>
                `).join('')}
              </div>
            `;

            openModal({ kicker: 'Công bố khoa học', title: item.title, bodyHtml: body, footerHtml: footer });
          }
        });
      });
    }

    // =====================
    // INIT
    // =====================
    document.addEventListener('DOMContentLoaded', () => {
      $('#year').textContent = new Date().getFullYear();

      renderThemeIcon();
      renderProfile();
      renderEducation();
      renderWork();
      renderSkills();

      // Research init
      setResearchTab('projects');

      wireReveal(document);
      wireSectionObserver();

      // Theme
      $('#themeToggle').addEventListener('click', toggleTheme);

      // Mobile menu
      $('#mobileMenuBtn').addEventListener('click', () => {
        const nav = $('#mobileNav');
        const btn = $('#mobileMenuBtn');
        const isOpen = !nav.classList.contains('hidden');
        nav.classList.toggle('hidden', isOpen);
        btn.setAttribute('aria-expanded', String(!isOpen));
      });

      // Close mobile nav on nav click
      $$('[data-nav]').forEach(a => {
        a.addEventListener('click', () => {
          $('#mobileNav').classList.add('hidden');
          $('#mobileMenuBtn').setAttribute('aria-expanded', 'false');
          setActiveNav(a.getAttribute('href'));
        });
      });

      // Initial active nav
      setActiveNav('#home');

      // Back to top
      const toTop = $('#toTop');
      window.addEventListener('scroll', () => {
        const show = window.scrollY > 700;
        toTop.classList.toggle('hidden', !show);
      }, { passive: true });
      toTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

      // Print
      $('#printBtn').addEventListener('click', () => window.print());
      $('#printResearch').addEventListener('click', () => window.print());

      // Education toggle
      $('#eduToggle').addEventListener('click', () => {
        const items = $$('.edu-item');
        const anyClosed = items.some(d => !d.open);
        items.forEach(d => d.open = anyClosed);
      });

      // Skills search
      $('#skillsSearch').addEventListener('input', (e) => {
        state.skillsQuery = e.target.value;
        renderSkills();
        wireReveal($('#skills'));
      });

      // Research tabs
      $$('.rt-btn').forEach(btn => {
        btn.addEventListener('click', () => setResearchTab(btn.getAttribute('data-tab')));
      });

      // Research search
      $('#researchSearch').addEventListener('input', (e) => {
        state.researchQuery = e.target.value;
        applyResearchFilter();
      });

      // Modal close
      $('#modalClose').addEventListener('click', closeModal);
      $('#modalOverlay').addEventListener('click', (e) => {
        if (e.target === $('#modalOverlay') || e.target === $('#modalOverlay').firstElementChild) closeModal();
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !$('#modalOverlay').classList.contains('hidden')) closeModal();
        // Shortcut to owner unlock (Ctrl+Shift+E)
        if (e.ctrlKey && e.shiftKey && (e.key === 'E' || e.key === 'e')) {
          unlockOwnerPrompt();
        }
      });

      // Contact copy email
      $('#copyEmailBtn').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(DATA.contact.email);
          toast('Đã sao chép email.');
        } catch(e) {
          toast('Không thể sao chép tự động.');
        }
      });

      // Contact form (mailto)
      $('#contactForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const hint = $('#contactFormHint');
        hint.classList.add('hidden');

        const name = $('#cfName').value.trim();
        const email = $('#cfEmail').value.trim();
        const subject = $('#cfSubject').value.trim();
        const message = $('#cfMessage').value.trim();

        if (!name || !email || !subject || !message) {
          hint.className = 'text-sm text-rose-600 dark:text-rose-300';
          hint.textContent = 'Vui lòng điền đầy đủ thông tin.';
          hint.classList.remove('hidden');
          return;
        }

        const to = DATA.contact.email;
        const body = [
          `Họ tên: ${name}`,
          `Email: ${email}`,
          '',
          message,
          '',
          '---',
          'Gửi từ website cá nhân (mailto).'
        ].join('\n');

        const url = `mailto:${encodeURIComponent(to)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.location.href = url;

        hint.className = 'text-sm text-emerald-700 dark:text-emerald-300';
        hint.textContent = 'Đã tạo email theo mẫu. Nếu không mở được, hãy sao chép nội dung và gửi thủ công.';
        hint.classList.remove('hidden');
      });

      // Owner mode init + UI
      applyOwnerUI();

      // Auto prompt if URL has ?owner=1
      try {
        const params = new URLSearchParams(location.search);
        if (params.get('owner') === '1' && !isOwnerUnlocked()) {
          unlockOwnerPrompt();
        }
      } catch(e) {}

      // Owner unlock button in footer
      $('#ownerUnlock').addEventListener('click', () => {
        if (isOwnerUnlocked()) {
          openOwnerPanel();
        } else {
          unlockOwnerPrompt();
        }
      });

      // Owner panel button in header
      $('#ownerPanelBtn').addEventListener('click', openOwnerPanel);

      // Ensure owner badge state
      applyOwnerUI();

      // Toast close
      $('#toastClose').addEventListener('click', () => $('#toast').classList.add('hidden'));
    });
  </script>
</body>
</html>

